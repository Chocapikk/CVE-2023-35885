<?php
 namespace App\Command; use Symfony\Component\Console\Input\InputInterface; use Symfony\Component\Console\Input\InputOption; use Symfony\Component\Console\Output\OutputInterface; use App\Command\Command as BaseCommand; use App\Entity\Manager\SiteManager as SiteEntityManager; use App\Entity\Manager\DatabaseManager as DatabaseEntityManager; use App\Entity\Manager\DatabaseServerManager as DatabaseServerEntityManager; use App\Database\Exporter as DatabaseExporter; class DatabaseExportCommand extends BaseCommand { const SYSTEM_USER_ROOT = "\x72\x6f\157\x74"; private SiteEntityManager $siteEntityManager; private DatabaseEntityManager $databaseEntityManager; private DatabaseServerEntityManager $databaseServerEntityManager; public function __construct(SiteEntityManager $siteEntityManager, DatabaseEntityManager $databaseEntityManager, DatabaseServerEntityManager $databaseServerEntityManager) { goto B2dd5; B2dd5: $this->siteEntityManager = $siteEntityManager; goto c920b; c920b: $this->databaseEntityManager = $databaseEntityManager; goto Eccf3; Eccf3: $this->databaseServerEntityManager = $databaseServerEntityManager; goto d3554; d3554: parent::__construct(); goto Abd18; Abd18: } protected function configure() : void { goto d99e5; F8751: $this->addOption("\x64\141\164\x61\142\141\163\x65\116\x61\x6d\145", null, InputOption::VALUE_REQUIRED); goto d2f31; c7030: $this->setDescription("\x63\x6c\x70\143\164\154\x20\144\142\72\x65\170\x70\x6f\x72\164\x20\55\55\144\x61\164\x61\142\x61\x73\x65\x4e\141\x6d\x65\75\x6d\x79\55\x64\x61\164\x61\142\x61\x73\145\40\x2d\x2d\146\151\x6c\x65\75\x64\x75\155\160\56\163\161\x6c\56\x67\172"); goto F8751; d2f31: $this->addOption("\x66\151\154\x65", null, InputOption::VALUE_REQUIRED); goto f3cdb; d99e5: $this->setName("\144\142\x3a\145\170\x70\x6f\x72\x74"); goto c7030; f3cdb: } protected function execute(InputInterface $input, OutputInterface $output) : int { try { goto c4cea; f6468: D79af: goto ff48d; eef55: c188b: goto bc801; e814c: $output->writeln(sprintf("\x3c\x69\x6e\x66\157\x3e\x44\141\x74\x61\x62\141\163\145\74\57\x69\156\146\157\76\40\x3c\143\x6f\155\x6d\145\x6e\x74\x3e\45\163\74\x2f\x63\x6f\155\155\145\156\x74\76\x20\74\x69\156\146\157\76\150\x61\x73\x20\x62\x65\x65\x6e\40\145\x78\x70\x6f\x72\x74\x65\144\x2e\74\x2f\x69\156\x66\157\x3e", $databaseName)); goto C0576; d156c: $isSuperUser = self::SYSTEM_USER_ROOT == $systemUserName; goto d1e71; D5f8f: if (false === is_null($databaseEntity)) { goto Ef964; } goto de727; d47a3: $systemUserName = $_SERVER["\x53\125\x44\x4f\137\x55\123\105\x52"] ?? ''; goto Abd58; B1a35: goto d9e8e; goto b712d; c4cea: $this->validateInput($input); goto e4ba8; C0576: return BaseCommand::SUCCESS; goto f6468; eec4c: return BaseCommand::FAILURE; goto D37ab; fbb9f: $systemUserName = self::SYSTEM_USER_ROOT; goto eef55; d1e71: $userIsAllowedToExport = true === $isSuperUser || true === $userBelongsToASite; goto f0dc5; ff48d: d9e8e: goto F4582; Fd82e: if (!(true === $isSuperUser || $siteEntity === $databaseEntity->getSite())) { goto D79af; } goto e2acd; Abd58: if (!("\x64\x65\x76" == $_ENV["\x41\120\120\x5f\105\116\126"])) { goto c188b; } goto fbb9f; Cc988: $databaseExporter->export(); goto e814c; Fa1bc: $databaseEntity = $this->databaseEntityManager->findOneByName($databaseName); goto D5f8f; b712d: Ef964: goto Fd82e; C80c2: $siteEntity = $this->siteEntityManager->findOneByUser($systemUserName); goto b4306; f0dc5: if (!(true === $userIsAllowedToExport)) { goto C50de; } goto Fa1bc; Aba41: d4507: goto C80c2; a991b: $file = sprintf("\x25\x73\x2f\x25\163", rtrim(getcwd(), "\x2f"), $file); goto Aba41; e4ba8: $databaseName = $input->getOption("\x64\141\x74\x61\142\141\163\145\x4e\141\x6d\x65"); goto f9587; b997d: $databaseExporter->setFile($file); goto Cc988; b4306: $userBelongsToASite = false === is_null($siteEntity); goto d156c; f9587: $file = $input->getOption("\x66\151\154\145"); goto d47a3; bc801: if (!(false === str_contains($file, "\x2f"))) { goto d4507; } goto a991b; fb552: $databaseExporter->setRunAsUser($systemUserName); goto b997d; e2acd: $databaseExporter = new DatabaseExporter($databaseEntity); goto fb552; de727: throw new \Exception(sprintf("\104\x61\x74\x61\142\141\x73\145\40\42\x25\x73\42\40\144\x6f\x65\163\x20\156\157\164\40\145\x78\151\x73\x74\56", $databaseName)); goto B1a35; F4582: C50de: goto eec4c; D37ab: } catch (\Exception $e) { goto f5408; Aee27: return BaseCommand::FAILURE; goto f3fd6; D6b52: $output->writeln(sprintf("\74\145\x72\162\157\x72\76\x25\x73\74\57\145\x72\x72\x6f\x72\76", $errorMessage)); goto Aee27; f5408: $errorMessage = $e->getMessage(); goto D6b52; f3fd6: } } }
