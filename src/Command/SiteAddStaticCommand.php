<?php
 namespace App\Command; use Symfony\Component\Console\Input\InputOption; use Symfony\Component\Console\Input\InputInterface; use Symfony\Component\Console\Output\OutputInterface; use Symfony\Component\Validator\ConstraintViolationList; use App\Command\SiteCommand as SiteCommand; use App\Entity\Site as SiteEntity; use App\Entity\Certificate as CertificateEntity; use App\Site\StaticSite; use App\Site\Ssl\DistinguishedName; use App\Site\Ssl\Generator\RsaKeyGenerator; use App\Site\Ssl\Generator\CsrGenerator; use App\Site\Ssl\Util\Openssl; use App\Site\Nginx\Vhost\StaticTemplate as StaticVhostTemplate; use App\Site\Creator\StaticSite as StaticSiteCreator; use App\Site\Nginx\Vhost\Processor\ServerName as ServerNameProcessor; use App\Site\Nginx\Vhost\Processor\RedirectServerName as RedirectServerNameProcessor; use App\Site\Nginx\Vhost\Processor\RedirectDomain as RedirectDomainProcessor; class SiteAddStaticCommand extends SiteCommand { private const VHOST_TEMPLATE_NAME = "\x53\164\x61\164\x69\143"; protected function configure() : void { goto Ea109; ba28e: $this->setComment("\x41\144\144\x69\156\x67\40\141\x20\x53\164\x61\x74\151\x63\x20\x48\124\115\114\x20\x53\151\x74\145"); goto a2056; a2056: $this->addOption("\x64\x6f\155\x61\x69\x6e\116\141\155\145", null, InputOption::VALUE_REQUIRED); goto E93d5; E93d5: $this->addOption("\163\x69\164\145\125\x73\145\x72", null, InputOption::VALUE_REQUIRED); goto B3a2f; B3a2f: $this->addOption("\x73\151\x74\x65\x55\163\x65\x72\120\x61\x73\163\167\x6f\x72\x64", null, InputOption::VALUE_REQUIRED); goto ed5eb; f411e: $this->setDescription("\143\154\160\143\x74\x6c\40\x73\x69\x74\145\x3a\141\144\x64\x3a\x73\x74\141\x74\x69\143\x20\x2d\55\x64\x6f\155\x61\151\x6e\x4e\141\155\x65\75\x77\167\167\56\x64\x6f\155\141\x69\x6e\x2e\143\157\155\40\x2d\x2d\163\x69\164\x65\125\163\x65\162\x3d\152\x6f\150\x6e\x20\55\55\x73\151\164\145\125\x73\145\x72\x50\x61\163\x73\x77\157\162\x64\75\x27\x21\163\145\143\162\145\164\x50\141\x73\163\x77\x6f\162\144\41\x27"); goto ba28e; Ea109: $this->setName("\x73\151\x74\x65\x3a\x61\x64\x64\72\x73\x74\141\164\151\143"); goto f411e; ed5eb: } protected function execute(InputInterface $input, OutputInterface $output) : int { try { goto cd296; ca6dd: $vhostTemplate = new StaticVhostTemplate($staticSite); goto d2df5; cc691: a2f7d: goto b83c2; Ea9e9: $rsaKeyGenerator = new RsaKeyGenerator(); goto E64fc; efd53: $staticSite->setSubdomain($subdomain); goto bbf36; A2203: if (!(true === is_null($subdomain))) { goto b5248; } goto B3240; C8571: $staticSite->setUser($siteEntity->getUser()); goto Bebd5; bbf36: $staticSite->setRootDirectory($siteEntity->getRootDirectory()); goto c8746; Ee1dd: $redirectionVhostTemplateFile = realpath(dirname(__FILE__) . "\x2f\56\x2e\57\56\56\57\162\x65\x73\x6f\x75\162\143\x65\x73\x2f\156\147\151\156\x78\57\x76\150\157\x73\164\x5f\x74\x65\155\160\154\141\164\145\x2f\162\145\144\151\162\x65\x63\x74"); goto aa40a; E5865: $staticSiteCreator->reloadNginxService(); goto ebe92; b79f9: $certificateEntity->setCsr($csr); goto D60c0; f82a1: $certificateEntity->setDefaultCertificate(true); goto Ee2bc; b83c2: E7661: goto Df6e6; f0ac2: $vhostTemplate->addProcessor(new RedirectDomainProcessor()); goto Af5d2; Ea6b8: $selfSignedCertificate = Openssl::createSelfSignedCertificate($privateKey, $csr); goto f82a1; Acbef: b5248: goto B4913; Fe66a: $staticSiteCreator->createIndexHtml(); goto f6a57; E50fe: Ae1c4: goto A658b; b28a1: $siteEntity = $this->siteEntityManager->createEntity(); goto B0ec4; A46f9: D71d5: goto C3f13; fce1d: if (!(true === is_null($subdomain) || "\167\167\x77" == $subdomain)) { goto c3366; } goto Ee1dd; D80e1: $subjectAlternativeNames = []; goto A2203; fe5b1: e38fb: goto c4848; A4bdd: $staticSiteCreator->createLogrotateFile(); goto Fe66a; da230: $staticSite = new StaticSite(); goto C8571; Aabab: $output->writeln(sprintf("\x3c\x69\x6e\146\157\x3e\123\x69\x74\x65\74\x2f\151\x6e\x66\157\x3e\x20\74\x63\157\155\x6d\145\x6e\164\x3e\45\x73\x3c\57\143\157\155\x6d\x65\x6e\164\x3e\40\x3c\151\x6e\146\x6f\76\x68\141\163\x20\x62\x65\x65\156\40\141\144\144\145\144\56\x3c\x2f\x69\156\146\157\x3e", $domainName)); goto d764a; dd618: $subdomain = false === empty($subdomain) ? $subdomain : null; goto A5db0; d1872: $staticSiteCreator->createNginxVhost(); goto E5865; Ad82b: $staticSiteCreator->createRootDirectory(); goto A4bdd; C3f13: $vhostTemplate = $vhostTemplateEntity->getTemplate(); goto b28a1; fa758: $staticSite->setRegistrableDomain($registrableDomain); goto efd53; B17cc: $resolvedDomainName = $this->domainNameParser->resolveDomainName($domainName); goto E680a; cd296: $this->validateInput($input); goto D4499; fe6c4: $subdomain = $resolvedDomainName->subDomain()->toString(); goto dd618; dedc5: $siteEntity->setVhostTemplate($vhostTemplate->getContent()); goto b1504; Ec277: if (0 == count($siteConstraints)) { goto Ae1c4; } goto Cc904; Ee2bc: $certificateEntity->setType(CertificateEntity::TYPE_SELF_SIGNED); goto b79f9; f6a57: $staticSiteCreator->createPrivateKeyAndCertificate(); goto d1872; d2f08: $siteEntity->setDomainName($domainName); goto Efc80; ce2d8: if (!(false === empty($redirectionVhostTemplate))) { goto Ea8b6; } goto e198d; B4913: if (!(false === is_null($subdomain) && "\167\x77\x77" == $subdomain)) { goto e38fb; } goto F5f0a; Bba09: $certificateEntity->setSite($siteEntity); goto Ea9e9; D60c0: $certificateEntity->setPrivateKey($privateKey->getPEM()); goto Db834; Af5d2: $vhostTemplate->build(); goto dedc5; Ed3c7: throw new \Exception(sprintf("\126\x68\x6f\x73\164\40\x54\x65\x6d\x70\x6c\141\x74\145\40\x22\45\x73\42\x20\x64\x6f\x65\163\40\156\x6f\x74\x20\145\x78\151\163\164\56", $vhostTemplate)); goto c7275; Efc80: $siteEntity->setRootDirectory($rootDirectory); goto Acce5; B0ec4: $siteEntity->setType(SiteEntity::TYPE_STATIC); goto d2f08; d764a: return SiteCommand::SUCCESS; goto cc691; Dea13: return $this->renderConstraints($constraints, $output); goto B97ec; B876b: $siteUserPassword = trim($input->getOption("\x73\x69\164\145\125\163\145\x72\x50\x61\163\163\167\157\x72\144")); goto B17cc; D4499: $domainName = trim($input->getOption("\144\157\x6d\x61\151\156\x4e\x61\x6d\145")); goto A35a0; D72f4: $siteEntity->setCertificate($certificateEntity); goto da230; B97ec: goto a2f7d; goto E50fe; c7275: goto E7661; goto A46f9; d2df5: $vhostTemplate->setContent($siteEntity->getVhostTemplate()); goto f3b9f; E64fc: $privateKey = $rsaKeyGenerator->generatePrivateKey(); goto D80e1; Cc904: $constraints = new ConstraintViolationList(); goto a0c31; B866e: $staticSiteCreator = new StaticSiteCreator($staticSite); goto df572; B3c37: $siteEntity->setVhostTemplate($vhostTemplate); goto D85f8; A35a0: $vhostTemplate = self::VHOST_TEMPLATE_NAME; goto c58ca; f6386: $vhostTemplate->addProcessor(new RedirectServerNameProcessor()); goto f0ac2; c8746: $staticSite->setCertificate($certificateEntity); goto F86ad; df572: $staticSiteCreator->createUser(); goto Ad82b; E680a: $registrableDomain = $resolvedDomainName->registrableDomain()->toString(); goto fe6c4; d24b5: c3366: goto B3c37; c697e: $staticSite->setDomainName($domainName); goto fa758; cf1db: $this->siteEntityManager->updateEntity($siteEntity); goto Aabab; Acce5: $siteEntity->setUser($siteUser); goto Bfc63; F5f0a: $subjectAlternativeNames[] = $registrableDomain; goto fe5b1; f3b9f: $vhostTemplate->resetProcessors(); goto c7911; d3780: $csr = $csrGenerator->generate(); goto Ea6b8; Db834: $certificateEntity->setCertificate($selfSignedCertificate); goto D72f4; E2143: if (false === is_null($vhostTemplateEntity)) { goto D71d5; } goto Ed3c7; A658b: $certificateEntity = $this->certificateEntityManager->createEntity(); goto Bba09; c4848: $distinguishedName = new DistinguishedName($domainName, $subjectAlternativeNames); goto F1a70; c58ca: $rootDirectory = $domainName; goto F1a51; ebe92: $staticSiteCreator->resetPermissions(); goto ca6dd; aa40a: $redirectionVhostTemplate = file_get_contents($redirectionVhostTemplateFile); goto ce2d8; B3240: $subjectAlternativeNames[] = sprintf("\167\167\x77\x2e\45\x73", $domainName); goto Acbef; bb80b: Ea8b6: goto d24b5; c7911: $vhostTemplate->addProcessor(new ServerNameProcessor()); goto f6386; b1504: $siteEntity->setApplication($vhostTemplateEntity->getName()); goto cf1db; F86ad: $staticSite->setVhostTemplate($siteEntity->getVhostTemplate()); goto B866e; F1a70: $csrGenerator = new CsrGenerator($privateKey, $distinguishedName); goto d3780; a0c31: $constraints->addAll($siteConstraints); goto Dea13; Bebd5: $staticSite->setUserPassword($siteEntity->getUserPassword()); goto c697e; e198d: $vhostTemplate = sprintf("\45\163\x25\163", $redirectionVhostTemplate, $vhostTemplate); goto bb80b; D85f8: $siteConstraints = $this->validator->validate($siteEntity); goto Ec277; F1a51: $siteUser = trim($input->getOption("\x73\x69\x74\x65\125\x73\145\162")); goto B876b; Bfc63: $siteEntity->setUserPassword($siteUserPassword); goto fce1d; A5db0: $vhostTemplateEntity = $this->vhostTemplateEntityManager->findOneByName($vhostTemplate); goto E2143; Df6e6: } catch (\Exception $e) { goto e8a14; e8a14: $errorMessage = $e->getMessage(); goto B3868; Ce851: return SiteCommand::FAILURE; goto fc33f; B3868: $output->writeln(sprintf("\x3c\145\x72\x72\157\162\76\45\x73\74\x2f\145\162\162\x6f\162\x3e", $errorMessage)); goto Ce851; fc33f: } } }
