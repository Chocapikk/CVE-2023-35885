<?php
 namespace App\Command; use Symfony\Component\Console\Input\InputOption; use Symfony\Component\Console\Input\InputInterface; use Symfony\Component\Console\Output\OutputInterface; use App\Command\SiteCommand as SiteCommand; use App\Entity\Site as SiteEntity; use App\Site\VarnishCache\Client as VarnishCacheClient; class VarnishCachePurgeCommand extends SiteCommand { protected function configure() : void { goto b2c22; b2c22: $this->setName("\166\x61\162\x6e\151\163\x68\x2d\143\141\143\150\145\x3a\x70\165\x72\x67\145"); goto fd3b8; fd3b8: $this->setDescription("\143\x6c\x70\x63\164\x6c\40\166\141\162\156\151\x73\150\x2d\143\x61\143\150\x65\72\x70\x75\162\x67\x65\40\x2d\x2d\x70\165\x72\147\x65\75\x61\154\x6c\40\x6f\x72\x20\55\x2d\x70\165\162\147\x65\75\x27\164\x61\147\61\x2c\164\141\x67\62\x27\40\x6f\x72\x20\x2d\55\x70\165\x72\x67\x65\75\x27\x68\164\164\160\163\x3a\x2f\57\x77\167\x77\x2e\x64\157\x6d\141\x69\156\56\x63\x6f\x6d\57\163\151\164\145\56\x68\164\155\154\47"); goto a043e; a043e: $this->addOption("\160\165\x72\147\x65", null, InputOption::VALUE_REQUIRED); goto fb426; fb426: } protected function execute(InputInterface $input, OutputInterface $output) : int { try { goto A7ae9; E4892: D54b8: goto Ea834; Aa59d: F2a03: goto Ca61e; D397f: if (!(SiteEntity::TYPE_PHP == $siteType)) { goto Beadf; } goto c5d2d; f3a74: if (!(false === empty($varnishCacheSettings))) { goto Da44b; } goto bd6d4; C667a: foreach ($purgeValues as $purgeValue) { goto Be868; a4bb7: B8c0a: goto Cf8a5; Eb139: F65a1: goto c6af4; ba712: A3917: goto Eb139; Cf8a5: $varnishCacheClient->purgeUrl($purgeValue); goto f117d; A1b76: if (true === str_starts_with($purgeValue, "\x68\x74\x74\x70")) { goto B8c0a; } goto bca83; Be868: $purgeValue = trim($purgeValue); goto c8974; c8974: if (!(false === empty($purgeValue))) { goto A3917; } goto A1b76; f117d: dfd84: goto ba712; bca83: $varnishCacheClient->purgeTag($purgeValue); goto c11d9; c11d9: goto dfd84; goto a4bb7; c6af4: } goto Db73c; fb189: if (!(false === is_null($siteEntity))) { goto cf5df; } goto f4518; Ed503: $systemUserName = $_SERVER["\x53\125\x44\x4f\x5f\125\x53\x45\x52"] ?? ''; goto c7105; d865b: Da44b: goto acf96; c7105: if (!(false === empty($systemUserName))) { goto d660e; } goto a0691; C2570: $site = $this->getSite($domainName); goto a910a; Dbed6: cf5df: goto b7863; F269b: goto D54b8; goto Aa59d; fda7b: return SiteCommand::SUCCESS; goto aafa3; A7ae9: $this->validateInput($input); goto Ad9c8; A4e30: $varnishCacheClient->purgeHost($domainName); goto E4892; f4518: $domainName = $siteEntity->getDomainName(); goto C2570; bd6d4: $varnishCacheClient = new VarnishCacheClient(); goto C86de; b7863: d660e: goto fda7b; c5d2d: $varnishCacheSettings = $site->getVarnishCacheSettings(); goto f3a74; a9273: if ("\x61\154\154" == $purge) { goto F2a03; } goto b24f7; Db73c: e31ae: goto F269b; b24f7: $purgeValues = array_map("\164\162\151\x6d", array_filter(explode("\x2c", trim($purge)))); goto C667a; Ea834: $output->writeln("\74\151\156\146\157\76\x56\141\x72\x6e\151\x73\150\x20\x43\141\143\150\145\x20\x68\x61\x73\x20\x62\x65\x65\156\40\160\x75\162\147\145\144\56\74\57\151\x6e\x66\157\x3e"); goto d865b; Ca61e: $cacheTagPrefix = $varnishCacheSettings["\143\x61\143\150\x65\x54\141\147\x50\162\x65\146\151\x78"]; goto e96e5; a910a: $siteType = $siteEntity->getType(); goto D397f; acf96: Beadf: goto Dbed6; Ad9c8: $purge = trim($input->getOption("\x70\x75\162\x67\145")); goto Ed503; e96e5: $varnishCacheClient->purgeTag($cacheTagPrefix); goto A4e30; C86de: $varnishCacheClient->setServer($varnishCacheSettings["\163\x65\162\166\145\x72"]); goto a9273; a0691: $siteEntity = $this->getSiteEntityBySiteUser($systemUserName); goto fb189; aafa3: } catch (\Exception $e) { goto c6228; f9594: $output->writeln(sprintf("\74\x65\162\162\157\x72\x3e\x25\163\74\57\x65\x72\162\157\162\76", $errorMessage)); goto F0553; c6228: $errorMessage = $e->getMessage(); goto f9594; F0553: return SiteCommand::FAILURE; goto c72b5; c72b5: } } }
