<?php
 namespace App\Command; use Symfony\Component\Console\Input\InputOption; use Symfony\Component\Console\Input\InputInterface; use Symfony\Component\Console\Output\OutputInterface; use Symfony\Component\Validator\ConstraintViolationList; use App\Command\SiteCommand as SiteCommand; use App\Entity\Site as SiteEntity; use App\Entity\Certificate as CertificateEntity; use App\Entity\NodejsSettings as NodejsSettingsEntity; use App\Site\NodejsSite; use App\Site\Ssl\DistinguishedName; use App\Site\Ssl\Generator\RsaKeyGenerator; use App\Site\Ssl\Generator\CsrGenerator; use App\Site\Ssl\Util\Openssl; use App\Site\Nginx\Vhost\NodejsTemplate as NodejsVhostTemplate; use App\Site\Creator\NodejsSite as NodejsSiteCreator; use App\Site\Nginx\Vhost\Processor\ServerName as ServerNameProcessor; use App\Site\Nginx\Vhost\Processor\RedirectServerName as RedirectServerNameProcessor; use App\Site\Nginx\Vhost\Processor\RedirectDomain as RedirectDomainProcessor; class SiteAddNodejsCommand extends SiteCommand { private const VHOST_TEMPLATE_NAME = "\x4e\x6f\144\x65\152\163"; protected function configure() : void { goto D08b1; a64d1: $this->setComment("\x41\144\144\x69\156\147\x20\141\x20\x4e\x6f\x64\145\x2e\152\x73\x20\123\151\164\x65"); goto dc881; Fc8c8: $this->addOption("\163\x69\x74\x65\x55\163\x65\162\x50\141\x73\x73\167\157\162\x64", null, InputOption::VALUE_REQUIRED); goto e1fd2; D38b7: $this->setDescription("\143\x6c\160\143\164\154\40\x73\151\x74\145\72\141\144\144\72\x6e\157\144\x65\x6a\163\40\55\55\x64\x6f\155\x61\x69\x6e\x4e\141\155\145\x3d\167\167\167\56\144\157\x6d\141\x69\156\x2e\143\157\155\40\55\55\156\x6f\144\x65\x6a\x73\126\145\x72\163\x69\x6f\156\75\61\x36\40\55\x2d\x61\160\160\120\x6f\162\164\75\63\x30\x30\60\40\55\x2d\163\151\164\x65\x55\163\145\162\x3d\152\x6f\x68\156\40\x2d\55\163\151\x74\145\125\163\145\162\x50\141\x73\163\x77\157\x72\x64\75\x27\41\x73\x65\x63\162\145\x74\120\141\163\163\x77\157\162\x64\x21\x27"); goto a64d1; dc881: $this->addOption("\x64\157\x6d\x61\x69\156\116\141\x6d\145", null, InputOption::VALUE_REQUIRED); goto b29fd; b29fd: $this->addOption("\156\x6f\x64\x65\152\x73\x56\145\x72\163\151\x6f\156", null, InputOption::VALUE_REQUIRED); goto Ee14c; Ee14c: $this->addOption("\x61\x70\160\x50\157\162\x74", null, InputOption::VALUE_REQUIRED); goto a25a5; a25a5: $this->addOption("\x73\x69\x74\x65\x55\163\145\162", null, InputOption::VALUE_REQUIRED); goto Fc8c8; D08b1: $this->setName("\x73\x69\x74\x65\72\x61\144\x64\x3a\156\157\144\x65\152\x73"); goto D38b7; e1fd2: } protected function execute(InputInterface $input, OutputInterface $output) : int { try { goto Ed213; C3629: $siteUserPassword = trim($input->getOption("\x73\151\164\x65\x55\163\145\x72\120\141\163\x73\x77\157\x72\x64")); goto b4219; df44f: $vhostTemplate = sprintf("\45\163\45\163", $redirectionVhostTemplate, $vhostTemplate); goto c6e26; B19c2: $nodejsSite->setUser($siteEntity->getUser()); goto f5bad; C14a6: if (!(true === is_null($subdomain) || "\x77\167\x77" == $subdomain)) { goto af174; } goto Ad4c5; Fcb48: $vhostTemplate->setContent($siteEntity->getVhostTemplate()); goto Eb6dd; c6e26: Fdac9: goto A1866; a9675: if (!(true === is_null($subdomain))) { goto e76df; } goto b7ed4; Ec9aa: $vhostTemplate->addProcessor(new RedirectDomainProcessor()); goto c5e5a; Ac454: $selfSignedCertificate = Openssl::createSelfSignedCertificate($privateKey, $csr); goto b29b4; eb104: $nodejsSettingsEntity->setPort($appPort); goto f53f9; b7d07: $nodejsSiteCreator->resetPermissions(); goto ea19f; D9d00: $nodejsSiteCreator->reloadNginxService(); goto b7d07; ad28d: $appPort = (int) $input->getOption("\x61\x70\160\x50\x6f\162\x74"); goto e97da; f5bad: $nodejsSite->setUserPassword($siteEntity->getUserPassword()); goto d7384; E3ba6: $nodejsSite->setNodejsSettings($nodejsSettingsEntity); goto E328f; E7d51: $siteEntity->setVhostTemplate($vhostTemplate); goto Ae9e1; E0223: $privateKey = $rsaKeyGenerator->generatePrivateKey(); goto De5f6; D26b7: $vhostTemplate = self::VHOST_TEMPLATE_NAME; goto Df7d4; C1423: e76df: goto d41b2; d41b2: if (!(false === is_null($subdomain) && "\167\x77\167" == $subdomain)) { goto B7d49; } goto F5e0a; ee4bc: $domainName = trim($input->getOption("\144\157\155\141\x69\156\116\x61\x6d\145")); goto D26b7; Ac277: $csrGenerator = new CsrGenerator($privateKey, $distinguishedName); goto Df431; b29b4: $certificateEntity->setDefaultCertificate(true); goto F4ef4; a11d1: if (!(false === empty($redirectionVhostTemplate))) { goto Fdac9; } goto df44f; c92ea: $nodejsSite->setSubdomain($subdomain); goto E926b; F0f57: goto c71c6; goto e64e3; c24fb: de38d: goto B872c; d9768: c71c6: goto c24fb; Bd50d: $nodejsSiteCreator->createNginxVhost(); goto D9d00; Cb6e1: $siteEntity->setVhostTemplate($vhostTemplate->getContent()); goto a3a0c; C4a2b: $siteEntity->setDomainName($domainName); goto C933d; E328f: $nodejsSite->setCertificate($certificateEntity); goto E8128; B03e1: $distinguishedName = new DistinguishedName($domainName, $subjectAlternativeNames); goto Ac277; Cbd94: goto de38d; goto B48f1; E879e: $subdomain = $resolvedDomainName->subDomain()->toString(); goto ca100; F09a4: $nodejsSite = new NodejsSite(); goto B19c2; e97da: $siteUser = trim($input->getOption("\x73\x69\x74\145\125\163\145\x72")); goto C3629; aebb4: $nodejsSiteCreator->createPrivateKeyAndCertificate(); goto Bd50d; ab0d1: $this->siteEntityManager->updateEntity($siteEntity); goto B3e45; A1866: af174: goto E7d51; bc101: $nodejsSettingsConstraints = $this->validator->validate($nodejsSettingsEntity); goto Bdb21; F12a0: $siteEntity->setType(SiteEntity::TYPE_NODEJS); goto C4a2b; E8128: $nodejsSite->setVhostTemplate($siteEntity->getVhostTemplate()); goto Cf8fb; Fe62a: $certificateEntity->setCsr($csr); goto Eda54; B5a02: $siteEntity->setUser($siteUser); goto faa3f; c5e5a: $vhostTemplate->build(); goto Cb6e1; Df431: $csr = $csrGenerator->generate(); goto Ac454; Eb6dd: $vhostTemplate->resetProcessors(); goto Fe44d; Ad4c5: $redirectionVhostTemplateFile = realpath(dirname(__FILE__) . "\x2f\x2e\x2e\x2f\x2e\56\x2f\162\145\x73\x6f\x75\162\143\x65\x73\57\x6e\x67\151\x6e\x78\57\166\150\x6f\x73\164\x5f\x74\x65\155\x70\x6c\x61\164\145\x2f\162\x65\144\x69\x72\145\143\164"); goto e0431; C25b4: $nodejsSettingsEntity->setNodejsVersion($nodejsVersion); goto eb104; Bfa3e: $certificateEntity->setCertificate($selfSignedCertificate); goto C26cd; C26cd: $siteEntity->setCertificate($certificateEntity); goto F09a4; B4e31: $certificateEntity = $this->certificateEntityManager->createEntity(); goto Ca26e; a3a0c: $siteEntity->setApplication($vhostTemplateEntity->getName()); goto ab0d1; Ca4c4: $nodejsSiteCreator->installNodejs(); goto aebb4; ea19f: $vhostTemplate = new NodejsVhostTemplate($nodejsSite); goto Fcb48; Ed213: $this->validateInput($input); goto ee4bc; E926b: $nodejsSite->setRootDirectory($siteEntity->getRootDirectory()); goto E3ba6; F1010: $nodejsSiteCreator->createRootDirectory(); goto e2f12; Ca26e: $certificateEntity->setSite($siteEntity); goto c9f2b; Df7d4: $rootDirectory = $domainName; goto c5971; E1c97: throw new \Exception(sprintf("\126\x68\157\163\x74\40\124\x65\x6d\x70\x6c\141\x74\145\x20\x22\45\163\42\x20\144\157\145\x73\x20\x6e\x6f\x74\40\145\x78\151\163\x74\56", $vhostTemplate)); goto Cbd94; d0c76: $registrableDomain = $resolvedDomainName->registrableDomain()->toString(); goto E879e; e0431: $redirectionVhostTemplate = file_get_contents($redirectionVhostTemplateFile); goto a11d1; F4ef4: $certificateEntity->setType(CertificateEntity::TYPE_SELF_SIGNED); goto Fe62a; De5f6: $subjectAlternativeNames = []; goto a9675; ac55b: $siteEntity->setNodejsSettings($nodejsSettingsEntity); goto C25b4; Eda54: $certificateEntity->setPrivateKey($privateKey->getPEM()); goto Bfa3e; B8e02: $nodejsSite->setRegistrableDomain($registrableDomain); goto c92ea; E3540: $vhostTemplateEntity = $this->vhostTemplateEntityManager->findOneByName($vhostTemplate); goto c54d3; c54d3: if (false === is_null($vhostTemplateEntity)) { goto A1f24; } goto E1c97; b7ed4: $subjectAlternativeNames[] = sprintf("\x77\167\167\x2e\x25\x73", $domainName); goto C1423; d7384: $nodejsSite->setDomainName($domainName); goto B8e02; B48f1: A1f24: goto Ebe4f; b08d4: $siteConstraints = $this->validator->validate($siteEntity); goto bc101; F5e0a: $subjectAlternativeNames[] = $registrableDomain; goto c0863; a6efb: $nodejsSiteCreator->createNvmDirectory(); goto Ca4c4; e2f12: $nodejsSiteCreator->createLogrotateFile(); goto a6efb; d28ad: $constraints = new ConstraintViolationList(); goto edb98; Ebe4f: $vhostTemplate = $vhostTemplateEntity->getTemplate(); goto A7526; edb98: $constraints->addAll($siteConstraints); goto f7987; B3e45: $output->writeln(sprintf("\x3c\x69\x6e\x66\x6f\76\123\151\x74\145\74\x2f\x69\x6e\146\x6f\x3e\x20\74\x63\x6f\x6d\155\145\156\164\76\x25\163\74\x2f\x63\157\x6d\155\145\x6e\164\76\x20\74\x69\x6e\x66\157\76\x68\141\x73\x20\142\x65\x65\x6e\40\x61\144\144\x65\144\56\74\x2f\x69\156\146\x6f\76", $domainName)); goto d55ed; e64e3: daa88: goto B4e31; A7526: $siteEntity = $this->siteEntityManager->createEntity(); goto F12a0; d55ed: return SiteCommand::SUCCESS; goto d9768; Cf8fb: $nodejsSiteCreator = new NodejsSiteCreator($nodejsSite); goto D4237; f7987: $constraints->addAll($nodejsSettingsConstraints); goto C1019; faa3f: $siteEntity->setUserPassword($siteUserPassword); goto C14a6; c9f2b: $rsaKeyGenerator = new RsaKeyGenerator(); goto E0223; F65d4: $vhostTemplate->addProcessor(new RedirectServerNameProcessor()); goto Ec9aa; C933d: $siteEntity->setRootDirectory($rootDirectory); goto B5a02; c5971: $nodejsVersion = (int) $input->getOption("\156\157\144\x65\152\163\126\145\162\163\x69\x6f\x6e"); goto ad28d; D4237: $nodejsSiteCreator->createUser(); goto F1010; ca100: $subdomain = false === empty($subdomain) ? $subdomain : null; goto E3540; c0863: B7d49: goto B03e1; Bdb21: if (0 == count($siteConstraints) && 0 == count($nodejsSettingsConstraints)) { goto daa88; } goto d28ad; b4219: $resolvedDomainName = $this->domainNameParser->resolveDomainName($domainName); goto d0c76; Ae9e1: $nodejsSettingsEntity = new NodejsSettingsEntity(); goto ac55b; C1019: return $this->renderConstraints($constraints, $output); goto F0f57; f53f9: $nodejsSettingsEntity->setSite($siteEntity); goto b08d4; Fe44d: $vhostTemplate->addProcessor(new ServerNameProcessor()); goto F65d4; B872c: } catch (\Exception $e) { goto c21ed; c21ed: $errorMessage = $e->getMessage(); goto c8233; B1057: return SiteCommand::FAILURE; goto C1cbe; c8233: $output->writeln(sprintf("\x3c\145\x72\x72\x6f\162\x3e\x25\163\x3c\57\x65\162\x72\157\x72\x3e", $errorMessage)); goto B1057; C1cbe: } } }
