<?php
 namespace App\Controller\Frontend; use Symfony\Component\HttpFoundation\Request; use Symfony\Component\HttpFoundation\Response; use Symfony\Component\Form\Extension\Core\Type\SubmitType; use Symfony\Component\Form\Form; use App\Controller\Controller; use App\Entity\Manager\UserManager; use App\Entity\Manager\TimezoneManager; use App\Security\Authenticator\MfaAuthenticator; use App\Entity\User; class UserController extends Controller { public function adminUserCreation(Request $request, UserManager $userManager, TimezoneManager $timezoneManager) : Response { goto cdc8f; aff60: $form = $this->createAdminUserCreationForm($user); goto E3bb1; Bf831: A1bb6: goto cac52; Aada8: $user->setRole(User::ROLE_ADMIN); goto Fd3e9; c5ecb: return $response; goto Bf831; cac52: F767d: goto A4098; ea986: $user = $userManager->createEntity(); goto Aada8; a2416: $isSubmitted = $form->isSubmitted(); goto c8edf; aeaa4: $form->handleRequest($request); goto a2416; c8edf: if (!(true === $isSubmitted)) { goto F767d; } goto Ec94e; F7e30: $user->setTimezone($timezone); goto aff60; a0d49: D22e0: goto ab89e; A4098: Fbe70: goto ab367; ab89e: $timezone = $timezoneManager->findOneByName("\x45\165\x72\157\x70\145\57\x42\x65\x72\x6c\151\156"); goto ea986; Ec94e: $response = $this->handleAdminUserCreationForm($request, $form, $userManager); goto d6466; d6466: if (!(false === is_null($response))) { goto A1bb6; } goto c5ecb; c58dd: if (!count($users)) { goto D22e0; } goto c3e39; cdc8f: $users = $userManager->findAll(); goto c58dd; E3bb1: if (!(true === $request->isMethod("\120\117\123\x54"))) { goto Fbe70; } goto aeaa4; Fd3e9: $user->setStatus(User::STATUS_ACTIVE); goto F7e30; ff4dd: return $response; goto A7877; c3e39: $response = $this->redirect($this->generateUrl("\x63\154\160\137\154\x6f\x67\151\x6e")); goto Cab2e; ab367: $response = $this->render("\106\x72\157\156\x74\145\x6e\144\57\x55\163\145\x72\x2f\141\144\155\151\156\55\x75\163\x65\162\x2d\x63\162\x65\141\x74\x69\x6f\x6e\x2e\150\x74\x6d\154\56\x74\167\x69\x67", ["\146\x6f\162\155\105\x72\162\x6f\162\x73" => $this->formErrors, "\146\x6f\162\155" => $form->createView()]); goto ff4dd; Cab2e: return $response; goto a0d49; A7877: } private function createAdminUserCreationForm(User $user) : Form { goto Dddad; Fb17a: return $form; goto a8498; Dfa2d: $form->add("\163\165\142\x6d\151\164", SubmitType::class, ["\x61\x74\164\162" => ["\143\x6c\x61\163\x73" => "\x62\164\156\x20\142\x74\x6e\x2d\x6c\147\40\142\x74\156\x2d\x62\x6c\x75\145\x20\142\164\x6e\55\143\162\145\x61\x74\145\55\165\163\x65\162"], "\x6c\x61\x62\145\x6c" => "\x43\x72\x65\141\164\145\40\125\x73\x65\x72"]); goto Fb17a; Dddad: $form = $this->createForm("\x41\160\x70\x5c\x46\x6f\162\155\x5c\x55\163\x65\x72\x41\144\x6d\x69\x6e\x55\163\x65\162\x43\x72\145\x61\x74\151\157\156\124\171\x70\145", $user, ["\141\x63\164\151\x6f\x6e" => $this->generateUrl("\143\154\160\x5f\141\x64\x6d\151\x6e\137\x75\x73\145\162\137\143\162\x65\x61\x74\x69\x6f\x6e"), "\x6d\x65\x74\150\x6f\x64" => "\120\117\x53\124", "\x61\x74\x74\x72" => []]); goto Dfa2d; a8498: } private function handleAdminUserCreationForm(Request $request, Form $form, UserManager $userManager) { goto F6947; bd52b: e4f76: goto D4c33; D6a0e: goto C1576; goto bd52b; D4c33: try { goto e8ca0; E6952: $userManager->updateUser($user); goto B6f0e; B6f0e: $response = $this->redirect($this->generateUrl("\143\154\x70\137\154\157\147\x69\x6e")); goto A18d5; Aef6b: $user = $form->getData(); goto E6952; A18d5: return $response; goto A37d4; e8ca0: $session = $request->getSession(); goto Aef6b; A37d4: } catch (\Exception $e) { $this->logger->exception($e); $session->getFlashBag()->set("\x64\141\x6e\147\x65\x72", $this->translator->trans("\101\x6e\40\x65\162\x72\x6f\162\x20\150\141\163\40\x6f\143\x63\165\x72\x72\x65\x64\x2c\x20\145\x72\162\157\x72\x20\155\145\x73\163\141\147\x65\72\40\x25\x65\x72\162\157\162\115\x65\x73\163\x61\147\x65\45", ["\45\x65\162\x72\157\x72\x4d\x65\163\x73\x61\x67\x65\45" => $e->getMessage()])); } goto e963f; e963f: C1576: goto f8adf; F6947: if (true === $form->isValid()) { goto e4f76; } goto edd65; edd65: $this->formErrors = $this->getErrorMessages($form); goto D6a0e; f8adf: } public function settings(Request $request, UserManager $userManager) : Response { goto C3715; f7d65: return $response; goto c163a; D3bc1: $isSubmitted = $form->isSubmitted(); goto F1342; c163a: Fbb5e: goto e142c; B80dd: $form = $this->createUserSettingsForm($user); goto e4af3; F8da6: $form->handleRequest($request); goto D3bc1; a2349: $response = $this->handleUserSettingsForm($request, $form, $userManager); goto b19b7; C3715: $user = $this->getUser(); goto B80dd; e142c: E94e0: goto f1d7e; B317b: return $response; goto B6d6d; f1d7e: C7fe1: goto eb80d; eb80d: $response = $this->render("\x46\x72\x6f\156\164\145\x6e\144\x2f\x55\163\x65\x72\x2f\x41\143\x63\157\165\x6e\164\x2f\x73\145\164\164\x69\x6e\x67\x73\56\x68\x74\155\x6c\x2e\164\x77\x69\x67", ["\x66\x6f\x72\x6d\x45\x72\162\x6f\x72\x73" => $this->formErrors, "\x66\157\162\x6d" => $form->createView()]); goto B317b; b19b7: if (!(false === is_null($response))) { goto Fbb5e; } goto f7d65; e4af3: if (!(true === $request->isMethod("\x50\117\x53\124"))) { goto C7fe1; } goto F8da6; F1342: if (!(true === $isSubmitted)) { goto E94e0; } goto a2349; B6d6d: } private function createUserSettingsForm(User $user) : Form { goto E825a; B200f: $form->add("\x73\165\x62\x6d\x69\x74", SubmitType::class, ["\141\164\164\162" => ["\143\154\141\163\x73" => "\142\x74\x6e\40\x62\164\x6e\x2d\x62\x6c\x75\145\x20\x62\x74\156\55\154\x67"], "\x6c\x61\142\x65\x6c" => "\123\x61\x76\145"]); goto A0bf8; A0bf8: return $form; goto d280a; E825a: $form = $this->createForm("\x41\160\160\x5c\106\x6f\162\x6d\x5c\x55\163\x65\162\x53\x65\x74\164\x69\156\147\163\x54\x79\160\x65", $user, ["\x61\x63\x74\151\157\156" => $this->generateUrl("\143\154\x70\137\x75\163\x65\x72\x5f\x73\x65\x74\x74\x69\x6e\x67\163"), "\155\145\x74\x68\x6f\144" => "\120\x4f\x53\x54", "\141\164\164\162" => []]); goto B200f; d280a: } private function handleUserSettingsForm(Request $request, Form $form, UserManager $userManager) { goto be5be; Fbe2b: goto f2bfc; goto E3f8c; E3f8c: Ce3cf: goto A55bd; be5be: if (true === $form->isValid()) { goto Ce3cf; } goto F87be; Cff8f: f2bfc: goto Ca64d; F87be: $this->formErrors = $this->getErrorMessages($form); goto Fbe2b; A55bd: try { goto A6475; b3de5: $user = $form->getData(); goto b029b; d43e1: $userManager->updateUser($user, true, true); goto Aaed8; C80af: $response = $this->redirect($this->generateUrl("\x63\x6c\160\x5f\165\163\145\162\x5f\x73\145\164\164\151\x6e\147\163")); goto Ef017; f2899: F8685: goto d43e1; E1e4a: if (false === empty($plainPassword)) { goto F8685; } goto F8abd; fdc92: goto af936; goto f2899; b029b: $plainPassword = $user->getPlainPassword(); goto E1e4a; Ef017: return $response; goto Eef46; Aaed8: af936: goto bf376; F8abd: $userManager->updateUser($user); goto fdc92; bf376: $session->getFlashBag()->set("\163\165\143\x63\x65\x73\x73", $this->translator->trans("\124\x68\145\40\141\x63\x63\x6f\165\156\x74\40\x69\x6e\x66\x6f\162\x6d\x61\164\151\x6f\156\40\x68\141\x73\40\142\145\x65\x6e\x20\x73\141\166\145\x64\56")); goto C80af; A6475: $session = $request->getSession(); goto b3de5; Eef46: } catch (\Exception $e) { $this->logger->exception($e); $session->getFlashBag()->set("\144\141\x6e\147\145\x72", $this->translator->trans("\101\156\x20\145\x72\162\x6f\x72\40\x68\141\x73\40\157\143\x63\165\x72\x72\x65\x64\54\40\145\162\162\x6f\x72\x20\155\x65\x73\x73\x61\x67\145\x3a\x20\x25\145\162\x72\x6f\x72\x4d\x65\x73\x73\141\147\x65\45", ["\x25\145\x72\162\x6f\x72\x4d\x65\x73\163\x61\x67\x65\x25" => $e->getMessage()])); } goto Cff8f; Ca64d: } public function security(Request $request) : Response { goto A474a; eca8b: $response = $this->render("\x46\x72\x6f\x6e\x74\145\x6e\x64\x2f\x55\x73\145\162\57\101\x63\x63\157\165\x6e\164\x2f\x73\145\x63\165\x72\x69\164\171\56\150\x74\x6d\x6c\x2e\164\167\151\x67", ["\x75\x73\145\x72" => $user]); goto bb5a6; bb5a6: return $response; goto b4708; A474a: $user = $this->getUser(); goto eca8b; b4708: } public function enableMfa(Request $request, UserManager $userManager) : Response { goto f548a; Ab5bd: if (!(true === $isSubmitted)) { goto d71c9; } goto dd3a5; d3d73: $isSubmitted = $form->isSubmitted(); goto Ab5bd; ae64a: $form->handleRequest($request); goto d3d73; d1e28: $mfaAuthenticator = new MfaAuthenticator(); goto F2cb2; f434f: $response = $this->render("\x46\162\x6f\x6e\164\145\156\144\x2f\125\163\x65\x72\57\101\143\143\157\165\x6e\x74\57\x65\x6e\141\142\x6c\x65\x2d\155\x66\x61\x2e\x68\x74\x6d\x6c\x2e\164\x77\x69\x67", ["\x71\162\x43\x6f\x64\145\114\151\x6e\x6b" => $qrCodeLink, "\x75\163\x65\162" => $user, "\x66\x6f\x72\155" => $form->createView(), "\x66\157\x72\155\x45\x72\162\x6f\162\163" => $this->formErrors]); goto Dd546; F2cb2: $qrCodeLink = $mfaAuthenticator->getQrCodeLink($user->getMfaSecret(), $user->getUserName(), "\x43\154\157\165\144\120\141\156\145\x6c"); goto bb43a; efe92: if (!(true === $user->hasMfaEnabled())) { goto e4a03; } goto Fc9ea; c9863: return $response; goto Da259; b6cb4: A74cb: goto f434f; Dd546: return $response; goto a2610; B6c83: if (!(false === is_null($response))) { goto Ec7d7; } goto e676a; e676a: return $response; goto D74c6; D74c6: Ec7d7: goto C270a; C270a: d71c9: goto b6cb4; f548a: $user = $this->getUser(); goto efe92; dd3a5: $response = $this->handleMfaCodeForm($request, $form, $userManager); goto B6c83; Da259: e4a03: goto d1e28; Fc9ea: $response = $this->redirect($this->generateUrl("\143\x6c\x70\137\x75\x73\145\162\x5f\x73\x65\143\165\x72\151\164\x79")); goto c9863; bb43a: $form = $this->createMfaCodeForm($user); goto D8f4f; D8f4f: if (!(true === $request->isMethod("\120\x4f\123\x54"))) { goto A74cb; } goto ae64a; a2610: } private function createMfaCodeForm(User $user) : Form { goto d0524; d0524: $form = $this->createForm("\101\160\160\134\x46\x6f\x72\x6d\134\125\163\145\x72\123\145\x63\165\162\151\164\171\x4d\x66\x61\x43\x6f\x64\x65\x54\171\x70\145", $user, ["\x61\x63\164\151\x6f\x6e" => $this->generateUrl("\x63\154\160\137\165\x73\x65\x72\137\x73\145\x63\x75\x72\x69\x74\x79\x5f\x65\156\141\142\154\x65\x5f\155\146\x61"), "\155\145\164\150\x6f\x64" => "\x50\x4f\x53\124", "\141\164\164\162" => []]); goto Caf31; a8b99: return $form; goto D5d95; Caf31: $form->add("\x73\x75\142\155\151\x74", SubmitType::class, ["\141\x74\x74\162" => ["\x63\154\141\163\x73" => "\x62\164\156\x20\142\164\x6e\55\142\x6c\x75\145\x20\x62\164\156\55\x6c\147\x20\142\164\x6e\55\x73\165\142\155\x69\164\55\155\146\x61\x2d\143\157\x64\x65"], "\x6c\x61\142\x65\154" => "\123\141\x76\145"]); goto a8b99; D5d95: } private function handleMfaCodeForm(Request $request, Form $form, UserManager $userManager) { goto D55e1; Ba91e: fedab: goto D0af7; D55e1: if (true === $form->isValid()) { goto fedab; } goto aa89f; C0257: Cb42e: goto c51eb; Eb159: goto Cb42e; goto Ba91e; aa89f: $this->formErrors = $this->getErrorMessages($form); goto Eb159; D0af7: try { goto c190d; c190d: $session = $request->getSession(); goto E2d37; fb6b9: return $response; goto Dd9f2; E2d37: $user = $this->getUser(); goto ef65c; ef65c: $user->setMfa(true); goto Eb93b; Fdd2b: $session->getFlashBag()->set("\163\x75\143\x63\x65\x73\163", $this->translator->trans("\124\167\157\55\106\141\143\x74\x6f\x72\x20\101\165\164\x68\x65\156\x74\151\x63\x61\164\151\157\156\40\150\141\x73\40\142\x65\145\x6e\x20\145\x6e\141\x62\x6c\x65\x64\x2e")); goto Dda57; Eb93b: $userManager->updateUser($user); goto Fdd2b; Dda57: $response = $this->redirect($this->generateUrl("\x63\x6c\160\x5f\165\x73\145\162\137\x73\x65\x63\165\x72\x69\164\x79")); goto fb6b9; Dd9f2: } catch (\Exception $e) { $this->logger->exception($e); $session->getFlashBag()->set("\x64\141\x6e\147\x65\162", $this->translator->trans("\101\x6e\40\x65\x72\162\x6f\162\40\150\141\163\x20\157\143\143\x75\162\162\145\144\54\x20\x65\x72\x72\157\x72\x20\x6d\x65\163\x73\141\147\x65\72\40\x25\x65\x72\162\157\162\x4d\145\x73\163\x61\x67\x65\x25", ["\45\145\162\162\157\162\115\x65\163\163\x61\147\145\x25" => $e->getMessage()])); } goto C0257; c51eb: } public function disableMfa(Request $request, UserManager $userManager) : Response { try { goto a8f76; A32b5: $user = $this->getUser(); goto c9bd1; a8f76: $session = $request->getSession(); goto A32b5; be613: $response = $this->redirect($this->generateUrl("\x63\x6c\x70\137\x75\x73\145\x72\137\x73\145\x63\x75\162\151\164\171")); goto ef56f; c9bd1: $user->setMfa(false); goto efc60; efc60: $userManager->updateUser($user); goto F215f; F215f: $session->getFlashBag()->set("\163\165\x63\143\145\x73\163", $this->translator->trans("\x54\x77\x6f\x2d\106\141\x63\x74\157\162\x20\x41\x75\164\x68\145\156\x74\151\x63\141\164\x69\x6f\156\x20\x68\x61\163\x20\x62\x65\145\x6e\40\144\151\163\141\x62\x6c\145\144\56")); goto be613; ef56f: } catch (\Exception $e) { goto A47d4; E80b5: $response = $this->redirect($this->generateUrl("\x63\154\x70\x5f\165\x73\145\162\x5f\163\145\x63\165\x72\x69\x74\x79")); goto Bb6c9; A47d4: $this->logger->exception($e); goto B7386; B7386: $session->getFlashBag()->set("\x64\x61\156\x67\145\162", $this->translator->trans("\x41\156\40\145\x72\x72\x6f\162\x20\x68\x61\163\40\x6f\x63\143\x75\x72\x72\x65\x64\x2c\40\145\162\x72\x6f\x72\40\x6d\x65\x73\163\x61\x67\145\72\x20\x25\x65\x72\162\x6f\162\x4d\145\x73\x73\x61\147\145\x25", ["\45\x65\x72\162\x6f\162\x4d\x65\163\163\x61\x67\145\x25" => $e->getMessage()])); goto E80b5; Bb6c9: } return $response; } }
