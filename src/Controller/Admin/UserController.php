<?php
 namespace App\Controller\Admin; use Symfony\Component\HttpFoundation\Request; use Symfony\Component\HttpFoundation\Response; use Symfony\Component\Form\Extension\Core\Type\SubmitType; use Symfony\Component\Form\Form; use App\Controller\Controller; use Symfony\Contracts\Translation\TranslatorInterface; use App\Entity\Manager\SiteManager as SiteEntityManager; use App\Entity\Manager\UserManager as UserEntityManager; use App\Entity\Manager\TimezoneManager as TimezoneEntityManager; use App\Entity\User as UserEntity; use App\Event\EventQueue; use App\Service\Logger; class UserController extends Controller { private UserEntityManager $userEntityManager; private SiteEntityManager $siteEntityManager; private TimezoneEntityManager $timezoneEntityManager; public function __construct(UserEntityManager $userEntityManager, SiteEntityManager $siteEntityManager, TimezoneEntityManager $timezoneEntityManager, TranslatorInterface $translator, Logger $logger) { goto ceaf9; B9cfb: parent::__construct($translator, $logger); goto f630d; Fea21: $this->siteEntityManager = $siteEntityManager; goto d1ac6; d1ac6: $this->timezoneEntityManager = $timezoneEntityManager; goto B9cfb; ceaf9: $this->userEntityManager = $userEntityManager; goto Fea21; f630d: } public function index(Request $request) : Response { goto Ec2b1; Ec2b1: $currentUser = $this->getUser(); goto C365c; E9dd6: $response = $this->render("\x41\144\155\151\x6e\57\125\163\145\x72\57\x69\156\144\145\x78\56\x68\x74\155\154\x2e\164\167\x69\147", ["\x75\163\145\x72\163" => $users]); goto f58e1; C365c: $users = $this->userEntityManager->findAll([], ["\165\163\x65\162\x4e\141\x6d\145" => "\141\163\143"]); goto feb8d; f58e1: return $response; goto b6b55; feb8d: $users = array_filter($users, function ($user) use($currentUser) { return $currentUser->getId() != $user->getId(); }); goto E9dd6; b6b55: } public function new(Request $request) : Response { goto d50b7; f66e0: D0599: goto Bd04b; d50b7: $userEntity = $this->userEntityManager->createEntity(); goto e2838; dc394: $form->handleRequest($request); goto f956a; De596: if (!(true === $request->isMethod("\120\x4f\123\124"))) { goto D0599; } goto dc394; C266c: if (!(false === is_null($response))) { goto A2229; } goto C4155; Bd04b: $response = $this->render("\x41\x64\x6d\151\156\x2f\x55\x73\x65\x72\x2f\x6e\x65\167\56\x68\164\155\x6c\56\164\167\x69\x67", ["\165\163\145\x72" => $userEntity, "\x73\151\164\145\163" => $sites, "\146\157\x72\x6d" => $form->createView(), "\x66\157\x72\155\x45\162\162\157\162\x73" => $this->formErrors]); goto c96b6; C2861: A2229: goto B0f2a; E25ba: $userEntity->setTimezone($defaultTimezone); goto Ea4da; c96b6: return $response; goto dc50c; f956a: if (!(true === $form->isSubmitted())) { goto Db64f; } goto Ed168; B0f2a: Db64f: goto f66e0; C4155: return $response; goto C2861; A10f2: $sites = $this->siteEntityManager->findAll([], ["\x64\157\x6d\141\151\156\x4e\x61\155\x65" => "\101\123\x43"]); goto E25ba; Ea4da: $form = $this->createUserForm($userEntity); goto De596; e2838: $defaultTimezone = $this->timezoneEntityManager->findOneByName(UserEntity::DEFAULT_TIMEZONE); goto A10f2; Ed168: $response = $this->handleUserForm($request, $form); goto C266c; dc50c: } private function createUserForm(UserEntity $userEntity) : Form { goto c0003; Cb915: return $form; goto B81ae; fa8b2: $form->add("\x73\165\142\x6d\x69\x74", SubmitType::class, ["\141\x74\164\162" => ["\x63\x6c\141\x73\x73" => "\142\164\x6e\x20\x62\164\156\55\x62\x6c\x75\x65\x20\142\x74\x6e\55\x6c\147"], "\x6c\x61\x62\145\x6c" => "\101\x64\x64\40\x55\163\145\x72"]); goto Cb915; c0003: $form = $this->createForm("\101\160\x70\134\106\x6f\x72\x6d\x5c\101\144\155\x69\x6e\125\163\x65\x72\124\x79\x70\x65", $userEntity, ["\x61\x63\164\x69\x6f\x6e" => $this->generateUrl("\143\154\x70\x5f\x61\144\155\151\156\137\165\x73\145\x72\x5f\156\x65\x77"), "\155\x65\164\150\x6f\x64" => "\120\x4f\123\x54", "\x61\x74\164\x72" => []]); goto fa8b2; B81ae: } private function handleUserForm(Request $request, Form $form) { goto E7e13; E7e13: if (true === $form->isValid()) { goto D1d5c; } goto C3bbb; ae99e: D1d5c: goto ce608; ce608: try { goto D9a75; ff188: $this->userEntityManager->updateUser($userEntity); goto f3e16; A493c: $response = $this->redirect($this->generateUrl("\x63\x6c\160\137\141\144\155\151\156\x5f\x75\163\145\162\163")); goto C37a0; C2fc5: $sites = $userEntity->getSites(); goto e8fcf; C37a0: return $response; goto c416a; f3e16: $eventData = ["\165\163\145\x72\x4e\141\155\145" => $userEntity->getUserName(), "\x66\151\x72\x73\164\116\141\155\x65" => $userEntity->getFirstName(), "\x6c\141\x73\x74\116\141\155\x65" => $userEntity->getLastName(), "\145\155\141\x69\x6c" => $userEntity->getEMail(), "\x72\x6f\x6c\x65" => $userEntity->getRole(), "\163\151\164\145\x73" => implode("\x2c\40", $domainNames)]; goto e1793; e8fcf: $domainNames = []; goto d7515; c3db2: $session = $request->getSession(); goto bf712; F47ae: A053e: goto Bf899; e1793: EventQueue::addEvent(EventQueue::EVENT_ADMIN_USER_ADD, $currentUser, $eventData, $request); goto E90e3; d7515: if (!(count($sites) && UserEntity::ROLE_USER == $userEntity->getRole())) { goto f4e84; } goto Ba65c; Ba65c: foreach ($sites as $site) { $domainNames[] = $site->getDomainName(); da6c3: } goto F47ae; Bf899: f4e84: goto c44c2; bf712: $userEntity = $form->getData(); goto C2fc5; c44c2: sort($domainNames); goto ff188; E90e3: $session->getFlashBag()->set("\163\x75\143\143\x65\163\163", $this->translator->trans("\125\163\145\162\40\x68\x61\163\40\142\145\x65\x6e\40\x61\x64\x64\x65\x64\56")); goto A493c; D9a75: $currentUser = $this->getUser(); goto c3db2; c416a: } catch (\Exception $e) { $this->logger->exception($e); $session->getFlashBag()->set("\144\x61\x6e\x67\145\162", $this->translator->trans("\101\x6e\40\145\x72\162\x6f\x72\40\x68\141\x73\x20\x6f\x63\143\165\x72\x72\145\144\54\40\x65\x72\x72\x6f\x72\x20\155\x65\163\x73\141\147\145\72\x20\45\145\x72\x72\x6f\x72\x4d\x65\163\x73\x61\x67\x65\45", ["\45\x65\x72\x72\x6f\162\115\x65\x73\x73\x61\147\x65\45" => $e->getMessage()])); } goto feeff; feeff: Cd6a4: goto Ee8c1; b9828: goto Cd6a4; goto ae99e; C3bbb: $this->formErrors = $this->getErrorMessages($form); goto b9828; Ee8c1: } public function edit(Request $request) : Response { goto e68db; d47d7: $userEntity = $this->userEntityManager->findOneById($id); goto Ad266; e68db: $id = (int) $request->get("\x69\x64"); goto d47d7; cf323: b2f28: goto b9b24; Ad266: if (false === is_null($userEntity)) { goto Bf569; } goto F72ac; A7652: ed25d: goto b5af9; Afa9c: goto D0307; goto A065b; b9b24: b7b1c: goto A7652; ab339: $form->handleRequest($request); goto e8b36; b5816: $form = $this->createUserEditForm($userEntity); goto be669; Ce94c: return $response; goto D3603; be669: if (!(true === $request->isMethod("\x50\117\x53\124"))) { goto ed25d; } goto ab339; e8b36: if (!(true === $form->isSubmitted())) { goto b7b1c; } goto A9b2d; f4d0c: return $response; goto cf323; E75ba: $sites = $this->siteEntityManager->findAll([], ["\144\157\155\x61\151\156\x4e\x61\x6d\145" => "\101\x53\103"]); goto b5816; A9b2d: $response = $this->handleUserEditForm($request, $form); goto B0639; D8f08: D0307: goto Ce94c; b5af9: $response = $this->render("\101\x64\155\x69\156\57\x55\163\145\162\57\145\144\x69\164\56\x68\164\x6d\x6c\x2e\164\167\151\x67", ["\x75\x73\145\162" => $userEntity, "\163\151\x74\145\x73" => $sites, "\146\157\x72\155" => $form->createView(), "\146\157\x72\155\x45\x72\x72\x6f\x72\163" => $this->formErrors]); goto D8f08; A065b: Bf569: goto E75ba; F72ac: $response = $this->redirect($this->generateUrl("\143\154\160\x5f\141\x64\x6d\x69\x6e\137\165\x73\145\x72\163")); goto Afa9c; B0639: if (!(false === is_null($response))) { goto b2f28; } goto f4d0c; D3603: } private function createUserEditForm(UserEntity $userEntity) : Form { goto D1c02; f1a07: return $form; goto e6ff8; D1c02: $form = $this->createForm("\x41\160\160\134\x46\x6f\x72\x6d\x5c\101\144\155\x69\156\x55\163\x65\x72\105\x64\x69\164\x54\x79\160\x65", $userEntity, ["\x61\143\x74\151\x6f\x6e" => $this->generateUrl("\x63\154\160\x5f\141\x64\155\x69\x6e\137\165\x73\x65\162\137\145\144\x69\164", ["\x69\144" => $userEntity->getId()]), "\155\x65\x74\150\157\144" => "\x50\x4f\123\124", "\x61\164\164\162" => []]); goto B9191; B9191: $form->add("\163\x75\142\155\x69\164", SubmitType::class, ["\x61\164\x74\162" => ["\143\x6c\141\x73\x73" => "\x62\164\156\40\x62\164\x6e\55\x62\154\165\x65\40\x62\x74\156\x2d\154\x67"], "\x6c\x61\142\145\154" => "\x53\141\x76\145"]); goto f1a07; e6ff8: } private function handleUserEditForm(Request $request, Form $form) { goto ea4ac; e669b: try { goto Ae8dc; ca191: EventQueue::addEvent(EventQueue::EVENT_ADMIN_USER_UPDATE, $currentUser, $eventData, $request); goto D9942; C0364: foreach ($sites as $site) { $domainNames[] = $site->getDomainName(); f4eeb: } goto c3cd2; B1257: $eventData = ["\165\163\x65\162\x4e\x61\x6d\145" => $userEntity->getUserName(), "\146\151\x72\x73\164\x4e\x61\155\145" => $userEntity->getFirstName(), "\154\x61\x73\164\116\141\x6d\x65" => $userEntity->getLastName(), "\145\155\141\x69\x6c" => $userEntity->getEMail(), "\162\x6f\154\145" => $userEntity->getRole(), "\163\164\141\x74\x75\x73" => (int) $userEntity->getStatus(), "\163\151\164\145\163" => implode("\54\x20", $domainNames)]; goto ca191; cdcb9: A3fa7: goto B1257; Bdb5f: $response = $this->redirect($this->generateUrl("\x63\x6c\160\137\141\144\155\x69\156\137\165\163\145\162\137\145\144\x69\164", ["\151\x64" => $userEntity->getId()])); goto f7cff; A8a56: sort($domainNames); goto A4bfe; Fd39d: goto A3fa7; goto c4dba; bd620: if (!(count($sites) && UserEntity::ROLE_USER == $userEntity->getRole())) { goto A6883; } goto C0364; db10d: $this->userEntityManager->updateUser($userEntity); goto Fd39d; A4bfe: if (false === empty($plainPassword)) { goto C1fc7; } goto db10d; E986c: $sites = $userEntity->getSites(); goto ef2d4; ef2d4: $domainNames = []; goto bd620; a350e: A6883: goto A8a56; c7244: $session = $request->getSession(); goto a7733; f7cff: return $response; goto D293b; D9942: $session->getFlashBag()->set("\163\165\x63\x63\145\163\163", $this->translator->trans("\x55\x73\145\x72\x20\x68\x61\163\x20\142\145\145\156\40\165\x70\144\x61\164\x65\144\x2e")); goto Bdb5f; A7fd9: $this->userEntityManager->updateUser($userEntity, true, true); goto cdcb9; Fbeb4: $plainPassword = $userEntity->getPlainPassword(); goto E986c; c4dba: C1fc7: goto A7fd9; a7733: $userEntity = $form->getData(); goto Fbeb4; c3cd2: fab95: goto a350e; Ae8dc: $currentUser = $this->getUser(); goto c7244; D293b: } catch (\Exception $e) { $this->logger->exception($e); $session->getFlashBag()->set("\144\141\156\x67\145\162", $this->translator->trans("\x41\156\x20\145\x72\162\157\162\40\150\x61\x73\x20\157\143\x63\x75\x72\162\x65\144\54\40\x65\162\x72\157\162\40\x6d\145\163\x73\x61\x67\x65\72\40\x25\x65\162\162\x6f\162\115\x65\163\163\x61\x67\x65\x25", ["\45\x65\162\162\x6f\162\x4d\145\x73\163\141\147\145\x25" => $e->getMessage()])); } goto b085f; db606: $this->formErrors = $this->getErrorMessages($form); goto A4a84; A4a84: goto e8b86; goto E172f; E172f: B4bb7: goto e669b; ea4ac: if (true === $form->isValid()) { goto B4bb7; } goto db606; b085f: e8b86: goto acd72; acd72: } public function delete(Request $request) : Response { goto C37ce; Be7d2: $session->getFlashBag()->set("\163\165\x63\x63\145\163\x73", $this->translator->trans("\125\163\x65\162\40\x68\141\x73\x20\x62\145\145\x6e\40\144\145\x6c\x65\x74\x65\x64\56")); goto E49c4; Cec62: $eventData = ["\x75\163\145\x72\x4e\x61\155\145" => $userEntity->getUserName(), "\x66\151\x72\163\164\x4e\141\x6d\x65" => $userEntity->getFirstName(), "\154\x61\x73\x74\116\141\x6d\x65" => $userEntity->getLastName(), "\x65\x6d\x61\151\x6c" => $userEntity->getEMail(), "\162\x6f\x6c\x65" => $userEntity->getRole()]; goto D11c0; d0d3c: $this->userEntityManager->deleteUser($userEntity); goto Be7d2; E7c96: $userEntity = $this->userEntityManager->findOneById($id); goto E12bc; e6ab1: $response = $this->redirect($this->generateUrl("\143\154\160\137\x61\x64\155\151\156\137\165\163\145\x72\x73")); goto C4e33; E12bc: if (!(false === is_null($userEntity))) { goto A5cb6; } goto Cbeb0; C37ce: $currentUser = $this->getUser(); goto aa18e; D11c0: EventQueue::addEvent(EventQueue::EVENT_ADMIN_USER_DELETE, $currentUser, $eventData, $request); goto d0d3c; C4e33: return $response; goto a7b2e; Dee8f: if (!(true === isset($id) && $id != $currentUser->getId())) { goto C46fb; } goto E7c96; aa18e: $id = (int) $request->get("\151\144"); goto Dee8f; Cbeb0: $session = $request->getSession(); goto Cec62; E49c4: A5cb6: goto c5410; c5410: C46fb: goto e6ab1; a7b2e: } }
