<?php
 namespace App\Controller; use Psr\Cache\CacheItemPoolInterface as CachePool; use Symfony\Component\HttpFoundation\Request; use Symfony\Component\HttpFoundation\Response; use Symfony\Component\HttpFoundation\RequestStack; use Symfony\Contracts\Cache\ItemInterface; use GuzzleHttp\Client as HttpClient; use GuzzleHttp\Psr7\Request as GuzzleRequest; use App\Entity\Manager\AnnouncementManager; use App\Entity\Manager\ConfigManager; use App\CloudPanel\Environment as CloudPanelEnvironment; class AppController extends Controller { const HTTP_CLIENT_TIMEOUT = 10; const APP_VERSION_CHECK_REQUEST_URL = "\150\x74\164\x70\163\72\x2f\x2f\166\x65\x72\163\x69\x6f\x6e\56\143\x6c\x6f\x75\x64\160\141\x6e\x65\154\56\151\157\57\166\x32"; public function displayAnnouncement(Request $request, AnnouncementManager $announcementManager) : Response { goto Bce1e; df4fa: $response = $this->render("\x50\x61\162\164\151\x61\154\x2f\x61\x6e\x6e\x6f\165\x6e\143\x65\155\x65\x6e\x74\56\x68\164\x6d\154\x2e\x74\x77\x69\147", ["\141\156\x6e\157\165\156\143\x65\x6d\145\x6e\x74" => $announcement]); goto c1f28; Bce1e: $user = $this->getUser(); goto Cfd54; c1f28: return $response; goto fd49a; Cfd54: $announcement = $announcementManager->findLatestUnreadAnnouncement($user); goto df4fa; fd49a: } public function setAnnouncementRead(Request $request, AnnouncementManager $announcementManager) : Response { goto f32c5; Bc1fe: $announcementId = (int) $request->get("\141\x6e\156\x6f\x75\x6e\143\x65\x6d\x65\x6e\164\x49\144"); goto a1606; A7abd: C3074: goto A2923; e979b: return $response; goto bf3e1; f32c5: $user = $this->getUser(); goto B0ac7; db938: if (!(false === is_null($announcement) && $announcement->getUser()->getId() == $user->getId())) { goto af775; } goto e3109; B0ac7: $response = new Response(); goto Bc1fe; e3109: $userAnnouncements = $announcementManager->findAllUnreadAnnouncementsForUser($user); goto C6543; a1606: if (!(true === $request->isMethod("\x50\117\x53\124") && false === empty($announcementId))) { goto e6378; } goto Ab7f1; bc09b: af775: goto C1f6f; c57ba: foreach ($userAnnouncements as $announcement) { goto D9a27; D9a27: $announcement->setIsRead(true); goto D0280; D0280: $announcementManager->updateEntity($announcement); goto ab1de; ab1de: bef6d: goto Fbc46; Fbc46: } goto A7abd; C6543: if (!(false === empty($userAnnouncements))) { goto c81bb; } goto c57ba; C1f6f: e6378: goto e979b; Ab7f1: $announcement = $announcementManager->findOneById($announcementId); goto db938; A2923: c81bb: goto bc09b; bf3e1: } public function checkAppVersion(Request $request, CachePool $cachePool, ConfigManager $configManager) : Response { goto bb71d; Ad02e: return $this->json($data); goto Cb6bd; c0fcd: if (!(false === empty($latestAppVersion) && false === empty($currentAppVersion))) { goto F41e9; } goto fd7fb; f8414: $currentAppVersion = $this->getParameter("\141\160\160\x5f\x76\x65\162\163\x69\157\x6e"); goto c0fcd; E9d7d: $requestUrl = sprintf("\x25\x73\x25\163", self::APP_VERSION_CHECK_REQUEST_URL, CloudPanelEnvironment::RELEASE_CHANNEL_TEST == $releaseChannel ? "\x2d\x74\x65\x73\x74" : ''); goto E3fa4; fd7fb: if (!(version_compare($latestAppVersion, $currentAppVersion) > 0)) { goto a44f6; } goto B6406; d20d4: F41e9: goto Ad02e; f8b89: $releaseChannel = (string) $configManager->get("\162\x65\x6c\145\x61\x73\145\x5f\x63\x68\x61\156\156\145\154"); goto E9d7d; E3fa4: $latestAppVersion = $cachePool->get("\x61\160\160\x5f\166\145\x72\163\x69\x6f\x6e", function (ItemInterface $item) use($requestUrl) { goto D3af7; D3af7: $item->expiresAfter(3600); goto b20dd; Fab8a: try { goto b59fe; b0afd: $responseStatusCode = $response->getStatusCode(); goto C530f; C3f02: $appVersion = trim((string) $response->getBody()); goto e5cce; E2d89: $response = $httpClient->send($request); goto b0afd; b59fe: $httpClient = new HttpClient($config); goto A5ac4; C530f: if (!(200 == $responseStatusCode)) { goto E455f; } goto C3f02; A5ac4: $request = new GuzzleRequest("\x47\x45\124", $requestUrl); goto E2d89; e5cce: E455f: goto d31ff; d31ff: } catch (\Exception $e) { } goto e7dfb; F38d2: $config = ["\164\151\x6d\x65\157\165\x74" => self::HTTP_CLIENT_TIMEOUT, "\x76\x65\162\151\x66\171" => false, "\150\145\141\x64\x65\162\x73" => ["\x55\163\145\x72\x2d\101\147\x65\156\164" => "\103\154\157\165\144\x50\141\156\x65\x6c\40\x76\62"]]; goto Fab8a; e7dfb: return $appVersion; goto A1b63; b20dd: $appVersion = ''; goto F38d2; A1b63: }); goto f8414; bb71d: $data = []; goto f8b89; Bbc42: a44f6: goto d20d4; B6406: $data["\x75\160\144\x61\164\x65\101\x76\141\151\x6c\141\142\154\x65"] = true; goto Bbc42; Cb6bd: } public function footerNavigation(RequestStack $requestStack) : Response { goto bc49e; A4216: return $response; goto f695c; fa52a: $isAdminArea = true === str_contains($requestUri, "\141\x64\155\151\156"); goto D4130; F8d7e: $requestUri = $mainRequest->getRequestUri(); goto fa52a; bc49e: $mainRequest = $requestStack->getMainRequest(); goto F8d7e; D4130: $response = $this->render("\120\x61\162\164\151\141\x6c\x2f\146\157\x6f\x74\x65\162\x2e\x68\164\155\154\56\164\x77\x69\147", ["\x69\163\x41\x64\x6d\151\156\x41\162\145\141" => $isAdminArea]); goto A4216; f695c: } public function changeLocale(Request $request) : Response { $response = $this->redirectToReferer($request); return $response; } }
