<?php
 namespace App\Site\Application; use App\System\Command\MoveFileCommand; use App\System\Command\DeleteFileCommand; use App\System\Command\DeleteDirectoryCommand; use App\System\Command\DownloadFileCommand; use App\System\Command\BsdTarExtractCommand; use App\System\Command\ChownCommand; use App\System\Command\FindChmodCommand; use App\System\Command\WordPressConfigCreateCommand; use App\System\Command\WordPressCoreInstallCommand; use App\System\Command\WordPressSetConfigValueCommand; class WordPressInstaller extends Installer { private const LATEST_VERSION = "\150\x74\164\160\163\72\57\x2f\167\x6f\162\x64\x70\x72\x65\163\163\x2e\x6f\162\147\57\154\x61\x74\x65\163\x74\x2e\x74\141\x72\x2e\147\x7a"; public function downloadAndExtractLatestVersion() { try { goto f4460; fc770: $downloadFileCommand->setOutputFile($downloadTmpFile); goto a1745; fb052: $this->commandExecutor->execute($deleteRootDirectoryCommand); goto F5a8c; Ef045: $deleteRootDirectoryCommand->setDirectory($rootDirectory); goto F0505; a4d9d: $downloadFileCommand = new DownloadFileCommand(); goto A0231; ccbfc: $this->commandExecutor->execute($moveFileCommand); goto C8199; Ad179: $htdocsDirectory = $this->getHtdocsDirectory(); goto d2f1b; f4460: $siteUser = $this->siteEntity->getUser(); goto Ad179; d2f1b: $wordPressHtdocsDirectory = sprintf("\x25\x73\57\x77\157\162\x64\160\162\145\163\x73\x2f", rtrim($htdocsDirectory, "\57")); goto E8675; E8675: $rootDirectory = $this->getRootDirectory(); goto eb8dd; A0231: $downloadFileCommand->setFile(self::LATEST_VERSION); goto fc770; a1745: $deleteRootDirectoryCommand = new DeleteDirectoryCommand(); goto Ef045; f0c44: $tarExtractCommand->setSourceFile($downloadTmpFile); goto d3976; c9768: $deleteDownloadTmpFile = new DeleteFileCommand(); goto c4938; B9d13: $this->commandExecutor->execute($downloadFileCommand, 120); goto fb052; c4938: $deleteDownloadTmpFile->setFile($downloadTmpFile); goto a4d9d; d3976: $tarExtractCommand->setDestinationFile($htdocsDirectory); goto B39b6; B39b6: $moveFileCommand = new MoveFileCommand(); goto e0cd0; F0505: $tarExtractCommand = new BsdTarExtractCommand(); goto f0c44; daa94: $moveFileCommand->setDestinationFile($rootDirectory); goto B9d13; F5a8c: $this->commandExecutor->execute($tarExtractCommand, 60); goto ccbfc; eb8dd: $downloadTmpFile = sprintf("\57\150\x6f\155\145\x2f\45\163\57\x74\155\x70\x2f\x25\163\56\164\x61\162\x2e\147\172", $siteUser, uniqid()); goto c9768; e0cd0: $moveFileCommand->setSourceFile($wordPressHtdocsDirectory); goto daa94; C8199: } catch (\Exception $e) { throw $e; } finally { $this->commandExecutor->execute($deleteDownloadTmpFile); } } public function createConfig(string $databaseHost, string $databaseName, string $databaseUserName, string $databaseUserPassword) : void { goto Ec0c1; Ec0c1: $rootDirectory = $this->getRootDirectory(); goto d8ea8; F4b7f: $createConfigCommand->setDatabaseHost($databaseHost); goto dccea; d8ea8: $createConfigCommand = new WordPressConfigCreateCommand(); goto f4be4; f0905: $this->commandExecutor->execute($createConfigCommand); goto B2255; f4be4: $createConfigCommand->setRootDirectory($rootDirectory); goto F4b7f; dccea: $createConfigCommand->setDatabaseName($databaseName); goto F4aeb; f6047: $createConfigCommand->setLocale("\145\x6e\137\x55\123"); goto f0905; F4aeb: $createConfigCommand->setDatabaseUserName($databaseUserName); goto C4f7a; C4f7a: $createConfigCommand->setDatabaseUserPassword($databaseUserPassword); goto f6047; B2255: } public function setConfigValue(string $key, mixed $value, bool $raw) : void { goto B74e6; B5968: $setConfigValueCommand->setKey($key); goto Cb32e; Cb32e: $setConfigValueCommand->setValue($value); goto f7dd8; ae4e6: $this->commandExecutor->execute($setConfigValueCommand); goto D54e5; E4649: $setConfigValueCommand = new WordPressSetConfigValueCommand(); goto Dc61c; B74e6: $rootDirectory = $this->getRootDirectory(); goto E4649; Dc61c: $setConfigValueCommand->setRootDirectory($rootDirectory); goto B5968; f7dd8: $setConfigValueCommand->setRaw($raw); goto ae4e6; D54e5: } public function installCore(bool $isMultiSite, string $url, string $title, string $adminUserName, string $adminPassword, string $adminEmail) : void { goto E7591; ff657: $installCoreCommand->setAdminEmail($adminEmail); goto Eb40f; Bec5d: $installCoreCommand = new WordPressCoreInstallCommand(); goto Bfed3; Bfed3: $installCoreCommand->setIsMultiSite($isMultiSite); goto E3a4c; E3a4c: $installCoreCommand->setRootDirectory($rootDirectory); goto cd3fa; E7591: $rootDirectory = $this->getRootDirectory(); goto Bec5d; fd920: $installCoreCommand->setAdminUser($adminUserName); goto c02ef; Eb40f: $this->commandExecutor->execute($installCoreCommand, 90); goto e6cd5; cd3fa: $installCoreCommand->setUrl($url); goto bab67; c02ef: $installCoreCommand->setAdminPassword($adminPassword); goto ff657; bab67: $installCoreCommand->setTitle($title); goto fd920; e6cd5: } public function resetPermissions() { goto Dc8db; A66f1: $chownHtdocsCommand = new ChownCommand(); goto Dca32; Dca32: $chownHtdocsCommand->setFile($htdocsDirectory); goto d1295; Dc8db: $siteUser = $this->siteEntity->getUser(); goto e2285; F2cea: $chmodHtdocsCommand->setFile($htdocsDirectory); goto F80c1; feb97: $chmodHtdocsCommand->setFileChmod(770); goto ab9c7; aeb65: $chownHtdocsCommand->setGroup($siteUser); goto f066d; e2285: $htdocsDirectory = $this->getHtdocsDirectory(); goto A66f1; a8f7a: $chownHtdocsCommand->setUser($siteUser); goto aeb65; F7f75: $this->commandExecutor->execute($chmodHtdocsCommand, 300); goto Ae2ce; ab9c7: $this->commandExecutor->execute($chownHtdocsCommand, 300); goto F7f75; f066d: $chmodHtdocsCommand = new FindChmodCommand(); goto F2cea; F80c1: $chmodHtdocsCommand->setDirectoryChmod(770); goto feb97; d1295: $chownHtdocsCommand->setRecursive(true); goto a8f7a; Ae2ce: } private function getHtdocsDirectory() : string { goto E2733; F8e82: $htdocsDirectory = sprintf("\57\150\157\155\x65\x2f\45\x73\x2f\x68\x74\x64\157\x63\163\x2f", $siteUser); goto Bd711; E2733: $siteUser = $this->siteEntity->getUser(); goto F8e82; Bd711: return $htdocsDirectory; goto Cf189; Cf189: } private function getRootDirectory() : string { goto d10ab; d10ab: $htdocsDirectory = $this->getHtdocsDirectory(); goto f0cba; d5d6e: return $rootDirectory; goto e7d82; f0cba: $rootDirectory = sprintf("\45\x73\x2f\x25\x73", rtrim($htdocsDirectory, "\x2f"), $this->siteEntity->getRootDirectory()); goto d5d6e; e7d82: } }
