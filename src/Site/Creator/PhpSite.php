<?php
 namespace App\Site\Creator; use App\Site\Creator as SiteCreator; use App\Site\Nginx\Vhost\PhpTemplate; use App\Site\PhpFpm\Pool; use App\Site\PhpFpm\PoolBuilder; use App\Site\PhpFpm\PoolReader; use App\System\Command\CreateDirectoryCommand; use App\System\Command\WriteFileCommand; use App\System\Command\CopyFileCommand; class PhpSite extends SiteCreator { private const INDEX_PHP_TEMPLATE = "\x3c\x3f\x70\150\x70\xa\12\x65\143\x68\x6f\40\47\x48\x65\154\154\157\40\x57\x6f\162\x6c\x64\40\72\x2d\51\47\73"; public function createPhpFpmPool() : void { goto f6131; de48f: $phpVersion = $phpSettings->getPhpVersion(); goto e653b; B7c8e: $phpSettings = $this->site->getPhpSettings(); goto Fdc4b; E9555: $pool->setPort($poolPort); goto C9b0a; de6fa: $poolContent = $poolBuilder->create($pool); goto d95ef; A4c30: $writePoolFileCommand->setContent($poolContent); goto b6e65; fd1d1: $latestPool = array_shift($pools); goto eee23; cc95b: $poolBuilder = new PoolBuilder(); goto de6fa; d89c4: $writePoolFileCommand->setFile($poolFile); goto A4c30; db61a: $poolReader = new PoolReader($poolDirectory); goto Cab66; B9b59: $pool->setUser($siteUser); goto c3488; f6131: $siteUser = $this->site->getUser(); goto B7c8e; Fdc4b: $domainName = $this->site->getDomainName(); goto de48f; d95ef: $poolFile = sprintf("\x2f\145\164\143\57\160\150\160\57\x25\163\57\x66\160\155\57\x70\157\x6f\154\x2e\x64\57\x25\163\56\143\x6f\x6e\x66", $phpVersion, $domainName); goto e7301; b6e65: $this->commandExecutor->execute($writePoolFileCommand); goto ebf7a; e7301: $writePoolFileCommand = new WriteFileCommand(); goto d89c4; C9b0a: $phpSettings->setPoolPort($poolPort); goto cc95b; eee23: $poolPort = $latestPool->getPort() + 1; goto B2ed6; c0bfd: $pool->setName($domainName); goto B9b59; B2dfb: usort($pools, function ($a, $b) { return $a->getPort() < $b->getPort(); }); goto fd1d1; e653b: $poolDirectory = sprintf("\57\x65\164\143\57\x70\x68\x70\57\x25\x73\57\x66\x70\155\x2f\x70\157\157\154\x2e\x64\57", $phpVersion); goto db61a; Cab66: $pools = $poolReader->getPools(); goto B2dfb; B2ed6: $pool = new Pool(); goto c0bfd; c3488: $pool->setGroup($siteUser); goto E9555; ebf7a: } public function createVarnishCacheStructure(array $varnishCacheSettings) { goto C9bca; a9180: $writeVarnishCachePurgeLogfileCommand->setContent(''); goto C2d29; ae049: $varnishCachePurgeLogfile = sprintf("\45\163\57\160\165\162\x67\x65\56\x6c\x6f\x67", rtrim($varnishCacheLogDirectory, "\x2f")); goto bf756; ee9dd: $varnishControllerSourceFile = realpath(dirname(__FILE__) . sprintf("\57\56\56\57\56\56\57\56\x2e\x2f\x72\145\163\157\165\x72\143\x65\x73\57\166\x61\x72\x6e\x69\x73\150\x2d\x63\x61\x63\x68\x65\57\x63\x6f\x6e\x74\x72\157\154\154\x65\x72\x2f\x25\163\x2f\x63\157\x6e\x74\x72\x6f\154\154\x65\x72\56\x70\150\160", $varnishController)); goto a4868; Da263: $copyVarnishControllerFileCommand->setDestinationFile($varnishCacheControllerFile); goto a744f; D966c: $writeVarnishCachePurgeLogfileCommand->setFile($varnishCachePurgeLogfile); goto a9180; A802b: $this->commandExecutor->execute($createVarnishCacheLogDirectoryCommand); goto E796c; E796c: $this->commandExecutor->execute($writeVarnishCachePurgeLogfileCommand); goto Bade9; d37ad: $createVarnishCacheLogDirectoryCommand->setDirectory($varnishCacheLogDirectory); goto A833a; F2229: $createVarnishCacheDirectoryCommand->setDirectory($varnishCacheDirectory); goto d1c92; C9bca: $varnishController = $varnishCacheSettings["\x63\x6f\156\x74\162\x6f\x6c\154\x65\x72"] ?? null; goto Fa3d3; ac676: F4650: goto ee9dd; f0bee: $writeVarnishCacheSettingsFileCommand->setContent(json_encode($varnishCacheSettings, JSON_PRETTY_PRINT)); goto D769d; Ca03a: $varnishCacheDirectory = sprintf("\x2f\x68\x6f\155\x65\x2f\45\x73\57\56\x76\141\162\x6e\x69\x73\x68\x2d\x63\141\x63\x68\x65\x2f", $siteUser); goto F4600; D769d: $copyVarnishControllerFileCommand = new CopyFileCommand(); goto Cea67; F4600: $varnishCacheLogDirectory = sprintf("\57\150\x6f\155\145\57\x25\163\x2f\x6c\x6f\x67\x73\x2f\x76\x61\x72\156\151\x73\150\55\x63\141\x63\x68\x65\57", $siteUser); goto af5bd; A833a: $writeVarnishCachePurgeLogfileCommand = new WriteFileCommand(); goto D966c; d1c92: $writeVarnishCacheSettingsFileCommand = new WriteFileCommand(); goto Ccc9f; Fa3d3: if (!(true === isset($varnishCacheSettings["\143\x6f\156\x74\x72\x6f\154\x6c\x65\x72"]))) { goto F4650; } goto ea4aa; af5bd: $varnishCacheSettingsFile = sprintf("\45\163\57\163\145\x74\x74\x69\156\147\x73\56\152\163\157\x6e", rtrim($varnishCacheDirectory, "\57")); goto ae049; Cea67: $copyVarnishControllerFileCommand->setSourceFile($varnishControllerSourceFile); goto Da263; a240f: $createVarnishCacheDirectoryCommand = new CreateDirectoryCommand(); goto F2229; a4868: $siteUser = $this->site->getUser(); goto Ca03a; a744f: $createVarnishCacheLogDirectoryCommand = new CreateDirectoryCommand(); goto d37ad; Ccc9f: $writeVarnishCacheSettingsFileCommand->setFile($varnishCacheSettingsFile); goto f0bee; bf756: $varnishCacheControllerFile = sprintf("\x25\163\x2f\143\157\x6e\164\162\x6f\154\x6c\x65\162\x2e\x70\x68\160", rtrim($varnishCacheDirectory, "\57")); goto a240f; Aca63: $this->commandExecutor->execute($copyVarnishControllerFileCommand); goto A802b; ea4aa: unset($varnishCacheSettings["\x63\157\156\x74\162\x6f\154\154\145\162"]); goto ac676; C2d29: $this->commandExecutor->execute($createVarnishCacheDirectoryCommand); goto f4e7c; f4e7c: $this->commandExecutor->execute($writeVarnishCacheSettingsFileCommand); goto Aca63; Bade9: } public function createIndexPhp() : void { goto Bbfb0; E2086: $writeIndexPhpFileCommand->setContent(self::INDEX_PHP_TEMPLATE); goto fc3e0; e8561: $indexPhpFile = sprintf("\x25\x73\x2f\x69\156\144\x65\170\x2e\160\x68\160", rtrim($rootDirectory, "\x2f")); goto a85fe; fc3e0: $this->commandExecutor->execute($writeIndexPhpFileCommand); goto a53ae; d8ef6: $writeIndexPhpFileCommand->setFile($indexPhpFile); goto E2086; Bbfb0: $rootDirectory = $this->getRootDirectory(); goto e8561; a85fe: $writeIndexPhpFileCommand = new WriteFileCommand(); goto d8ef6; a53ae: } public function reloadPhpFpmService() { goto d41d2; B0202: $phpVersion = $phpSettings->getPhpVersion(); goto E0c7f; E0c7f: $serviceName = sprintf("\160\x68\160\45\x73\x2d\x66\160\x6d", $phpVersion); goto A7072; A7072: $this->reloadService($serviceName); goto a87bc; d41d2: $phpSettings = $this->site->getPhpSettings(); goto B0202; a87bc: } }
